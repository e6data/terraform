apiVersion: karpenter.sh/v1beta1
kind: NodePool
metadata:
  name: e6data-nodepool
spec:
  template:
    metadata:
      labels:
        app: e6data
        e6data-workspace-name: ${workspace_name}
    spec:
      requirements:
        - key: "karpenter.k8s.aws/instance-family"
          operator: In
          values: ["c7g", "c6g", "r6g", "r7g"]
        - key: topology.kubernetes.io/zone
          operator: In
          values: ["us-east-1b","us-east-1c","us-east-1d","us-east-1a","us-east-1e"]
      nodeClassRef:
        name: e6data-nodeclass-${workspace_name}
      taints:
        - key: "e6data-workspace-name"
          value: ${workspace_name}
          effect: NoSchedule  
  limits:
    cpu: 100000
  disruption:
    consolidationPolicy: WhenUnderutilized
